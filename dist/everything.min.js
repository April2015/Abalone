var gameLogic;!function(a){function b(){for(var b=[],c=0;c<a.ROWS;c++){b[c]=[];for(var d=0;d<a.COLS;d++)b[c][d]=""}for(var e=0;e<a.PLACES.length;e++){var f=a.PLACES[e],c=f.row,d=f.col;b[c][d]="O"}return b}function c(){var a=b();return a[0][4]="W",a[0][6]="W",a[0][10]="B",a[0][12]="B",a[1][3]="W",a[1][5]="W",a[1][7]="W",a[1][9]="B",a[1][11]="B",a[1][13]="B",a[2][4]="W",a[2][6]="W",a[2][10]="B",a[2][12]="B",a[6][4]="B",a[6][6]="B",a[6][10]="W",a[6][12]="W",a[7][3]="B",a[7][5]="B",a[7][7]="B",a[7][9]="W",a[7][11]="W",a[7][13]="W",a[8][4]="B",a[8][6]="B",a[8][10]="W",a[8][12]="W",a}function d(){var a=c(),b={board:a,isInitialState:!0,blackRemoved:0,whiteRemoved:0};return b}function e(a){return 6===a.blackRemoved?"W":6===a.whiteRemoved?"B":""}function f(b){for(var c=0;c<a.DIREC.length;c++){var d=a.DIREC[c];if(angular.equals(b,d))return!0}return!1}function g(b,c,d){var e=b.board;if(c.selfMarbles.length>3||0===c.selfMarbles.length)return!1;if(c.selfMarbles.length<=c.opponentMarbles.length)return!1;if(!f(c.direction))return!1;for(var g=0;g<c.selfMarbles.length;g++){var h=c.selfMarbles[g].row,i=c.selfMarbles[g].col;if(0>h||h>=a.ROWS||0>i||i>=a.COLS||e[h][i]!==(0===d?"B":"W"))return!1}for(var g=0;g<c.opponentMarbles.length;g++){var h=c.opponentMarbles[g].row,i=c.opponentMarbles[g].col;if(0>h||h>=a.ROWS||0>i||i>=a.COLS||e[h][i]!==(0===d?"W":"B"))return!1}if(!c.isInline){if(0!==c.opponentMarbles.length)return!1;for(var g=0;g<c.selfMarbles.length;g++){var h=c.selfMarbles[g].row+c.direction.row,i=c.selfMarbles[g].col+c.direction.col;if(0>h||h>=a.ROWS||0>i||i>=a.COLS||"O"!==e[h][i])return!1}var j;if(c.selfMarbles.length>1){var k=c.selfMarbles[1].row-c.selfMarbles[0].row,l=c.selfMarbles[1].col-c.selfMarbles[0].col;if(j={row:k,col:l},!f(j))return!1}if(3===c.selfMarbles.length){var m=c.selfMarbles[2].row-c.selfMarbles[1].row,n=c.selfMarbles[2].col-c.selfMarbles[1].col,o={row:m,col:n};if(!angular.equals(j,o))return!1}}if(c.isInline){for(var g=1;g<c.selfMarbles.length;g++){var p=c.selfMarbles[g-1].row+c.direction.row,q=c.selfMarbles[g-1].col+c.direction.col;if(p!==c.selfMarbles[g].row||q!==c.selfMarbles[g].col)return!1}var r=c.selfMarbles.length,h=c.selfMarbles[r-1].row+c.direction.row,i=c.selfMarbles[r-1].col+c.direction.col;if(r=c.opponentMarbles.length,0>h||h>=a.ROWS||0>i||i>=a.COLS||0===r&&"O"!==e[h][i])return!1;if(r>0&&(c.opponentMarbles[0].row!==h||c.opponentMarbles[0].col!==i))return!1;if(2===r){var s=c.opponentMarbles[1].row-c.opponentMarbles[0].row,t=c.opponentMarbles[1].col-c.opponentMarbles[0].col;if(s!==c.direction.row||t!==c.direction.col)return!1}if(r>0){var u=c.opponentMarbles[r-1].row+c.direction.row,v=c.opponentMarbles[r-1].col+c.direction.col;if(u>=0&&u<a.ROWS&&v>=0&&v<a.COLS&&("B"===e[u][v]||"W"===e[u][v]))return!1}}return!0}function h(b,c,f){if(b&&0!==Object.keys(b).length||(b=d()),"B"===e(b)||"W"===e(b))throw new Error("Can only make a move if the game is not over!");if(!g(b,c,f))throw new Error("Action is invalid and game is halted!");var h=angular.copy(b);if(h.isInitialState===!0&&(h.isInitialState=!1),!c.isInline)for(var i=0;i<c.selfMarbles.length;i++){var j=c.selfMarbles[i].row,k=c.selfMarbles[i].col;h.board[j][k]="O",j+=c.direction.row,k+=c.direction.col,h.board[j][k]=0===f?"B":"W"}if(c.isInline){var j=c.selfMarbles[0].row,k=c.selfMarbles[0].col;h.board[j][k]="O";var l=c.selfMarbles.length;if(j=c.selfMarbles[l-1].row+c.direction.row,k=c.selfMarbles[l-1].col+c.direction.col,h.board[j][k]=0===f?"B":"W",l=c.opponentMarbles.length,l>0){var m=c.opponentMarbles[l-1].row+c.direction.row,n=c.opponentMarbles[l-1].col+c.direction.col;m>=0&&m<a.ROWS&&n>=0&&n<a.COLS&&"O"===b.board[m][n]?h.board[m][n]=0===f?"W":"B":0===f?h.whiteRemoved++:h.blackRemoved++}}var o,p=e(h);o="B"===p||"W"===p?{endMatch:{endMatchScores:"B"===p?[1,0]:[0,1]}}:{setTurn:{turnIndex:1-f}};var q=[o,{set:{key:"board",value:h.board}},{set:{key:"isInitialState",value:h.isInitialState}},{set:{key:"blackRemoved",value:h.blackRemoved}},{set:{key:"whiteRemoved",value:h.whiteRemoved}},{set:{key:"action",value:c}}];return q}function i(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[5].set.value,f=h(d,e,c);if(angular.equals(b,f))return!0}catch(g){return!1}return!1}a.ROWS=9,a.COLS=17,a.DIREC=[{row:0,col:2},{row:1,col:-1},{row:1,col:1},{row:0,col:-2},{row:-1,col:1},{row:-1,col:-1}],a.PLACES=[{row:0,col:4},{row:0,col:6},{row:0,col:8},{row:0,col:10},{row:0,col:12},{row:1,col:3},{row:1,col:5},{row:1,col:7},{row:1,col:9},{row:1,col:11},{row:1,col:13},{row:2,col:2},{row:2,col:4},{row:2,col:6},{row:2,col:8},{row:2,col:10},{row:2,col:12},{row:2,col:14},{row:3,col:1},{row:3,col:3},{row:3,col:5},{row:3,col:7},{row:3,col:9},{row:3,col:11},{row:3,col:13},{row:3,col:15},{row:4,col:0},{row:4,col:2},{row:4,col:4},{row:4,col:6},{row:4,col:8},{row:4,col:10},{row:4,col:12},{row:4,col:14},{row:4,col:16},{row:5,col:1},{row:5,col:3},{row:5,col:5},{row:5,col:7},{row:5,col:9},{row:5,col:11},{row:5,col:13},{row:5,col:15},{row:6,col:2},{row:6,col:4},{row:6,col:6},{row:6,col:8},{row:6,col:10},{row:6,col:12},{row:6,col:14},{row:7,col:3},{row:7,col:5},{row:7,col:7},{row:7,col:9},{row:7,col:11},{row:7,col:13},{row:8,col:4},{row:8,col:6},{row:8,col:8},{row:8,col:10},{row:8,col:12}],a.getInitialBoard=c,a.getInitialState=d,a.getWinner=e,a.isStepValid=g,a.createMove=h,a.isMoveOk=i}(gameLogic||(gameLogic={}));var game;!function(a){function b(){console.log("Translation of 'RULES_OF_ABALONE' is "+translate("RULES_OF_ABALONE")),resizeGameAreaService.setWidthToHeight(1),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:e}),document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),t=!0,v&&d()})}function d(){gameService.makeMove(aiService.createComputerMove(w,x,{millisecondsLimit:1e3}))}function e(a){log.info("Game got updateUI:",a),t=!1,w=a.stateAfterMove,w.board||(w=gameLogic.getInitialState()),u=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,x=a.turnIndexAfterMove,v=u&&""===a.playersInfo[a.yourPlayerIndex].playerId,v&&(u=!1,w.isInitialState===!0&&d())}function f(a,b){if(log.info("Clicked on cell:",a,b),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(u)try{if(9==a&&0==b&&(y=!0,z=!1),9==a&&1==b&&(z=!0,y=!1),9==a&&2==b&&(y=!1,z=!1,A=[]),9==a&&3==b){B=[];var c=g();if(gameLogic.isStepValid(w,c,x)){var d=gameLogic.createMove(w,c,x);u=!1,gameService.makeMove(d)}y=!1,z=!1,A=[]}if(9>a&&(y===!0||z===!0)){var e={row:a,col:a%2+2*b};A.push(e)}}catch(f){return void log.info(["Illegal movement from",a,b])}}function g(){var a=0===x?"B":"W",b=0===x?"W":"B",c={isInline:y,direction:{row:0,col:0},selfMarbles:[],opponentMarbles:[]};if(y===!0&&A.length>1){c.direction.row=A[1].row-A[0].row,c.direction.col=A[1].col-A[0].col,c.selfMarbles.push(A[0]);for(var d=A[1].row,e=A[1].col;d>=0&&8>=d&&e>=0&&16>=e;){var f={row:d,col:e};if(B.push(f),""===w.board[d][e]&&B.pop(),w.board[d][e]==a)c.selfMarbles.push(f),d+=c.direction.row,e+=c.direction.col;else{if(w.board[d][e]!=b)break;c.opponentMarbles.push(f),d+=c.direction.row,e+=c.direction.col}}}if(z===!0&&A.length>1){c.direction.row=A[1].row-A[0].row,c.direction.col=A[1].col-A[0].col;for(var g=0;g+2<=A.length;)c.selfMarbles.push(A[g]),B.push(A[g+1]),g+=2}return c}function h(a,b){var c=a%2+2*b,d=w.board[a][c];return"B"===d||"W"===d?!0:!1}function i(a,b){var c=a%2+2*b;return"B"===w.board[a][c]}function j(){return 0===x}function k(){return 6===w.whiteRemoved}function l(){return w.blackRemoved}function m(a,b){var c=a%2+2*b;return"W"===w.board[a][c]}function n(){return 1===x}function o(){return 6===w.blackRemoved}function p(){return w.whiteRemoved}function q(a,b){for(var c=!1,d=a%2+2*b,e=0;e<B.length;e++)if(B[e].row===a&&B[e].col===d){c=!0;break}return!t&&c&&h(a,b)}function r(a){return"B"===a?"imgs/black.png":"W"===a?"imgs/white.png":""}function s(a,b){var c=a%2+2*b,d=w.board[a][c];return r(d)}var t=!1,u=!1,v=!1;a.isHelpModalShown=!1;var w=null,x=null,y=!1,z=!1,A=[],B=[];a.init=b,a.cellClicked=f,a.clickToAction=g,a.shouldShowImage=h,a.isPieceB=i,a.isBsTurn=j,a.blackWin=k,a.blackRemoved=l,a.isPieceW=m,a.isWsTurn=n,a.whiteWin=o,a.whiteRemoved=p,a.shouldSlowlyAppear=q,a.getImageSrc=s}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_ABALONE:"Rules of Abalone",RULES_SLIDE1:"Each side has 14 marbles and takes turns to move; whoever first scores 6 points wins. Only in an inline move can one score 1 point by pushing the other's marble off board",RULES_SLIDE2:"Inline: Marbles in a line can be moved along the line by 1 step; at most 3 of your own marbles and less of your opponent's can be moved.",INLINE_MOVE:"Click on 'Inline Move' button; click on a marble to start and the next marble/position along the moving direction; submit move;",RULES_SLIDE3:"Broadside: Two to Three of your own marbles in a line can be moved to empty positions in a neighboring parallel line. ",BROADSIDE:"Click on 'Broad-side' button; for each marble to be moved, first click on the marble and then its new position; submit move;",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a){return d(a.stateAfterMove,a.turnIndexAfterMove,{millisecondsLimit:1e3})}function c(a,b){for(var c=[],d=a.board,e=0===b?"B":"W",f=0,g=gameLogic.PLACES;f<g.length;f++){var h=g[f],i=h.row,j=h.col;if(d[i][j]===e)for(var k=0;6>k;k++){for(var l=gameLogic.DIREC[k],m=i,n=j,o=[h],p=0;2>p&&(m+=l.row,n+=l.col,!(0>m||m>=gameLogic.ROWS||0>n||n>=gameLogic.COLS||d[m][n]!==e));p++)o.push({row:m,col:n});var q=o.length;m=i+q*l.row,n=j+q*l.col;var r=0>m||m>=gameLogic.ROWS||0>n||n>=gameLogic.COLS||""===d[m][n]||d[m][n]===e;if(!r){if("O"===d[m][n]){var s={isInline:!0,direction:l,selfMarbles:o,opponentMarbles:[]};try{c.push(gameLogic.createMove(a,s,b))}catch(t){}}if(d[m][n]===(0===b?"W":"B")){var u=[{row:m,col:n}];m+=l.row,n+=l.col,m>=0&&m<gameLogic.ROWS&&n>=0&&n<gameLogic.COLS&&d[m][n]===(0===b?"W":"B")&&u.push({row:m,col:n});var s={isInline:!0,direction:l,selfMarbles:o,opponentMarbles:u};try{var v=gameLogic.createMove(a,s,b);if(""!==gameLogic.getWinner(v[2].set.value))return c=[v];c.push(v)}catch(t){}}}if(!(1>=q||k>2))for(;q>=2;){for(var w=0;5>w;w++)if(w!==k&&w!==k+3)try{var s={isInline:!1,direction:gameLogic.DIREC[w],selfMarbles:o,opponentMarbles:[]};gameLogic.isStepValid(a,s,b)&&c.push(gameLogic.createMove(a,s,b))}catch(t){}3===q&&o.pop(),q--}}}return c}function d(a,b,c){return alphaBetaService.alphaBetaDecision([null,null,{set:{key:"state",value:a}}],b,f,e,"?debug"===window.location.search?g:null,c)}function e(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function f(a,b){return c(a[2].set.value,b)}function g(a){return"\n"+a[2].set.value.board.join("\n")+"\n"}a.findComputerMove=b,a.getPossibleMoves=c,a.createComputerMove=d}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map